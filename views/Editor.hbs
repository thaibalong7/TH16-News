<div class="list_cata">

    <div class="col-md-12">
        <div class="row">
            <div class="list-cata">
                {{#each category}}
                <h1>Danh sách bài viết chuyên mục {{name}}</h1>
                {{/each}}
                <div id="post-list-category">
                    {{#each news}}
                    <div class="col-md-12">
                        <div class="post post-row">
                            <a class="post-img" href="#"><img src="./img/{{img}}"></a>
                            <div class="post-body">
                                <div class="post-meta">
                                    <a class="post-category" href="#">{{type}}</a>
                                    <a class="post-category cat-4" href="#">{{category}}</a>
                                    <span class="post-date">{{publicAt}}</span>

                                    <button type="button" class="post-category cat-2" data-toggle="modal" data-target="#approve-modal"
                                        style="float:right">Duyệt</button>
                                    <button type="button" class="post-category cat-3" data-toggle="modal" data-target="#reject-modal"
                                        style="float:right">Từ chối</button>
                                </div>
                                <h3 class="post-title"><a>{{name}}</a></h3>
                                <p class="post-abstract">{{abstract}}</p>
                            </div>
                        </div>
                    </div>
                    {{/each}}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="reject-modal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h2 class="modal-title">Lý do từ chối vài biết: </h2>
            </div>
            <div class="modal-body">
                <textarea placeholder="Viết lý do từ chối vào đây"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-modal-cancel" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn-modal-send">Gửi</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="approve-modal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h2 class="modal-title">Bạn đồng ý duyệt bài viết này? </h2>
            </div>
            <div class="modal-body">
                <h3>Bạn có muốn điều chỉnh lại chuyên mục và các nhãn của bài viết này?</h3>
                <table>
                    <tr>
                        <td>
                            <h4>Chuyên mục chính:</h4>
                        </td>
                        <td>
                            <select onchange="editor_change_select_category()" id="editor_select_category">
                                <option value="none">Chuyên mục</option>
                            </select>
                        </td>
                    </tr>
                </table>
                <table>
                    <tr>
                        <td>
                            <h4>Chuyên mục phụ: </h4>
                        </td>
                        <td>
                            <select id="editor_select_sub_category" onchange="editor_change_select_sub_category()"
                                required>
                            </select>
                        </td>
                    </tr>
                </table>
                <table>
                    <tr>
                        <td>
                            <h4>Tag:</h4>
                        </td>
                        <td><select id="select_id_3">
                                {{#each tag}}
                                <option value={{.}}>{{.}}</option>
                                {{/each}}
                            </select>
                        </td>
                        <td><button id="editor_btn_add_tag" onclick="val3()">+</button></td>
                    </tr>
                </table>
                <div>
                    <h4>Danh sách tag đã thêm: </h4>
                    <div id="edit_list_tag">
                    </div>
                </div>
                <div id="date_time">
                    <table id="form-profile-xuatban">
                        <tr>
                            <td>
                                <h4>Ngày xuất bản: </h4>
                            </td>
                            <td>
                                <div><input type="datetime-local" name="bdaytime">
                            </td>

                        </tr>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-modal-cancel" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn-modal-send">Duyệt</button>
                <button id="button-xuatban">Xuất bản ngay</button>
            </div>
        </div>
    </div>
    <script>
        var list_tag = []
        function val3() {
            e = document.getElementById("select_id_3");
            var strUser = e.options[e.selectedIndex].text;
            var value = e.value;
            var s = new String("");
            if (list_tag.length == 0)
                list_tag.push(strUser);
            else {
                let count = 1;
                for (let i = 0; i < list_tag.length; i++) {
                    if (list_tag[i] === strUser) {
                        count = -1;
                        break;
                    }
                }
                if (count === 1) list_tag.push(strUser);
            }
            for (let i = 0; i < list_tag.length; i++) {
                s = s + "<label id = 'label" + i + "'>" + list_tag[i] + "<button id ='" + i + "' onClick = 'val4(this.id)'>X</button></label>" + '\n';
            }
            console.log(s);
            document.getElementById("edit_list_tag").innerHTML = s;
        }
        function val4(clicked_id) {
            var s1 = clicked_id;
            var ss = new String("label" + s1);
            var sss = document.getElementById(ss).textContent;
            var subsss = sss.substring(0, sss.length - 1);
            var index = list_tag.indexOf(subsss);
            if (index > -1) {
                list_tag.splice(index, 1);
            }
            var s = new String("");
            for (let i = 0; i < list_tag.length; i++) {
                s = s + "<label id = 'label" + i + "'>" + list_tag[i] + "<button id ='" + i + "' onClick = 'val4(this.id)'>X</button></label>" + '\n';
            }
            console.log(s);
            document.getElementById("edit_list_tag").innerHTML = s;
        }

        let list_sub_category;
        const edit_news_form = $("#edit-news-form");
        $.ajax("/api/categories/getAllCategories", {
            type: 'get',
            dataType: 'json'
        }).done(function (data) {
            const select_category = $("#edit_select_category");
            for (let i = 0, l = data.data.list_category.length; i < l; i++) {
                select_category.append(` <option value=${data.data.list_category[i].id}>${data.data.list_category[i].name}</option>`)
            };
            list_sub_category = data.data.list_sub_category;
        }).fail(function (xhr, textStatus, errorThrown) {
            var err = JSON.parse(xhr.responseText);
            alert(err.msg);
        });
        function editor_change_select_category() {
            e = document.getElementById("edit_select_category");
            var strUser = e.options[e.selectedIndex].text; // chuỗi được chọn ở chuyên mục cấp 1
            const select_sub_category = $("#edit_select_sub_category");
            for (let i = 0, l = list_sub_category[strUser].length; i < l; i++) {
                select_sub_category.append(` <option value=${list_sub_category[strUser][i].id}>${list_sub_category[strUser][i].name}</option>`)
            };
        }

        function editor_change_select_sub_category() {
            e = document.getElementById("edit_select_sub_category");
            var strUser = e.options[e.selectedIndex].text; // chuỗi được chọn ở chuyên mục cấp 2
            var value = e.value; // giá trị được chọn ở chuyên mục cấp 1
        }

    </script>
</div>